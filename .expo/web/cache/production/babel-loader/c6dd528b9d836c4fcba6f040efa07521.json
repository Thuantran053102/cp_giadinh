{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _react=_interopRequireWildcard(require(\"react\"));var _reactNative=require(\"react-native\");var Permissions=_interopRequireWildcard(require(\"expo-permissions\"));var _expoBarcodeScanner=require(\"expo-barcode-scanner\");var _nativeBase=require(\"native-base\");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!==\"function\")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!==\"default\"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var ScanQR=function(_Component){(0,_inherits2.default)(ScanQR,_Component);var _super=_createSuper(ScanQR);function ScanQR(){var _this;(0,_classCallCheck2.default)(this,ScanQR);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={hasCameraPermission:null,scanned:false,isLogin:false,id_user:null};_this.getPermissionsAsync=function _callee(){var _await$Permissions$as,status;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator.default.awrap(Permissions.askAsync(Permissions.CAMERA));case 2:_await$Permissions$as=_context.sent;status=_await$Permissions$as.status;_this.setState({hasCameraPermission:status==='granted'});case 5:case\"end\":return _context.stop();}}},null,null,null,Promise);};_this.handleBarCodeScanned=function(_ref){var type=_ref.type,data=_ref.data;_this.setState({scanned:true});_this.props.scanResult(data);};_this.reScan=function(){_this.setState({scanned:false});};_this.closeScreen=function(){_this.props.closeScreen();};return _this;}(0,_createClass2.default)(ScanQR,[{key:\"componentDidMount\",value:function componentDidMount(){var local,user;return _regenerator.default.async(function componentDidMount$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regenerator.default.awrap(_reactNative.AsyncStorage.getItem(\"user\"));case 3:local=_context2.sent;user=JSON.parse(local);if(user!==null){this.setState({isLogin:true,id_user:user.id});this.getPermissionsAsync();}else{this.props.navigation.replace(\"Login\",{tab:0});}_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}}},null,this,[[0,8]],Promise);}},{key:\"render\",value:function render(){var _this$state=this.state,hasCameraPermission=_this$state.hasCameraPermission,scanned=_this$state.scanned,isLogin=_this$state.isLogin;if(!isLogin){return _react.default.createElement(_nativeBase.Text,{style:{textAlign:\"center\",marginTop:20}},\"\\u0110ang chuy\\u1EC3n \\u0111\\u1EBFn \\u0111\\u0103ng nh\\u1EADp\");}if(hasCameraPermission===null){return _react.default.createElement(_nativeBase.Text,{style:{textAlign:\"center\",marginTop:20}},\"Y\\xEAu c\\u1EA7u quy\\u1EC1n truy c\\u1EADp camera\");}if(hasCameraPermission===false){return _react.default.createElement(_nativeBase.Text,{style:{textAlign:\"center\",marginTop:20}},\"Kh\\xF4ng truy c\\u1EADp \\u0111\\u01B0\\u1EE3c camera\");}return _react.default.createElement(_nativeBase.Container,null,_react.default.createElement(_reactNative.ScrollView,null,_react.default.createElement(_reactNative.View,{style:{height:_reactNative.Dimensions.get(\"screen\").height}},_react.default.createElement(_expoBarcodeScanner.BarCodeScanner,{onBarCodeScanned:scanned?undefined:this.handleBarCodeScanned,style:[_reactNative.StyleSheet.absoluteFill,styles.container],barCodeTypes:Object.values(_expoBarcodeScanner.BarCodeScanner.Constants.BarCodeType)},_react.default.createElement(_reactNative.View,{style:styles.layerTop}),_react.default.createElement(_reactNative.View,{style:styles.layerCenter},_react.default.createElement(_reactNative.View,{style:styles.layerLeft}),_react.default.createElement(_reactNative.View,{style:styles.focused}),_react.default.createElement(_reactNative.View,{style:styles.layerRight})),_react.default.createElement(_reactNative.View,{style:styles.layerBottom})))),scanned?_react.default.createElement(_nativeBase.Button,{iconRight:true,onPress:this.reScan,full:true},_react.default.createElement(_nativeBase.Text,{uppercase:false},\"Th\\u1EED qu\\xE9t l\\u1EA1i\"),_react.default.createElement(_nativeBase.Icon,{type:\"SimpleLineIcons\",name:\"frame\"})):_react.default.createElement(_nativeBase.Button,{iconRight:true,onPress:this.closeScreen,full:true,danger:true},_react.default.createElement(_nativeBase.Text,{uppercase:false},\"\\u0110\\xF3ng\"),_react.default.createElement(_nativeBase.Icon,{type:\"SimpleLineIcons\",name:\"close\"})));}}]);return ScanQR;}(_react.Component);var _default=ScanQR;exports.default=_default;var opacity='rgba(0, 0, 0, .8)';var styles=_reactNative.StyleSheet.create({container:{flex:1,flexDirection:'column'},layerTop:{flex:1,backgroundColor:opacity},layerCenter:{flex:3,flexDirection:'row'},layerLeft:{flex:1,backgroundColor:opacity},focused:{flex:10},layerRight:{flex:1,backgroundColor:opacity},layerBottom:{flex:2,backgroundColor:opacity}});","map":{"version":3,"names":["ScanQR","state","hasCameraPermission","scanned","isLogin","id_user","getPermissionsAsync","Permissions","askAsync","CAMERA","status","setState","handleBarCodeScanned","type","data","props","scanResult","reScan","closeScreen","AsyncStorage","getItem","local","user","JSON","parse","id","navigation","replace","tab","console","log","textAlign","marginTop","height","Dimensions","get","undefined","StyleSheet","absoluteFill","styles","container","Object","values","BarCodeScanner","Constants","BarCodeType","layerTop","layerCenter","layerLeft","focused","layerRight","layerBottom","Component","opacity","create","flex","flexDirection","backgroundColor"],"sources":["D:/React_Native/SourceCode_VPM_Swine/screen/Users/ScanQR.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { View, StyleSheet, Dimensions, ScrollView, AsyncStorage } from 'react-native';\nimport * as Permissions from 'expo-permissions';\nimport {\n    BarCodeScanner\n} from 'expo-barcode-scanner';\nimport { Button, Container, Text, Icon } from 'native-base';\n\nclass ScanQR extends Component {\n    state = {\n        hasCameraPermission: null,\n        scanned: false,\n        isLogin: false,\n        id_user: null\n    };\n\n    async componentDidMount() {\n        try {\n            let local = await AsyncStorage.getItem(\"user\");\n            let user = JSON.parse(local);\n            if (user !== null) {\n                this.setState({ isLogin: true, id_user: user.id })\n                this.getPermissionsAsync();\n            } else {\n                this.props.navigation.replace(\"Login\", { tab: 0 })\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    getPermissionsAsync = async () => {\n        const {\n            status\n        } = await Permissions.askAsync(Permissions.CAMERA);\n        this.setState({\n            hasCameraPermission: status === 'granted'\n        });\n    };\n\n\n    handleBarCodeScanned = ({ type, data }) => {\n        this.setState({\n            scanned: true\n        });\n        this.props.scanResult(data);\n    }\n\n    reScan = () => {\n        this.setState({ scanned: false })\n    }\n\n    closeScreen = () => {\n        this.props.closeScreen();\n    }\n\n    render() {\n        const {\n            hasCameraPermission,\n            scanned,\n            isLogin\n        } = this.state;\n\n        if (!isLogin) {\n            return <Text style={{ textAlign: \"center\", marginTop: 20 }}>Đang chuyển đến đăng nhập</Text>;\n        }\n\n        if (hasCameraPermission === null) {\n            return <Text style={{ textAlign: \"center\", marginTop: 20 }}>Yêu cầu quyền truy cập camera</Text>;\n        }\n        if (hasCameraPermission === false) {\n            return <Text style={{ textAlign: \"center\", marginTop: 20 }}>Không truy cập được camera</Text>;\n        }\n\n        return <Container>\n        {/* <Button danger><Text>Đóng</Text></Button> */}\n            <ScrollView>\n                <View style={{ height: Dimensions.get(\"screen\").height }}>\n                    <BarCodeScanner\n                        onBarCodeScanned={scanned ? undefined : this.handleBarCodeScanned}\n                        style={[StyleSheet.absoluteFill, styles.container]}\n                        barCodeTypes={Object.values(BarCodeScanner.Constants.BarCodeType)}\n                    >\n                        <View style={styles.layerTop} />\n                        <View style={styles.layerCenter}>\n                            <View style={styles.layerLeft} />\n                            <View style={styles.focused} />\n                            <View style={styles.layerRight} />\n                        </View>\n                        <View style={styles.layerBottom} />\n                    </BarCodeScanner>\n                </View>\n\n            </ScrollView>\n            {scanned ? \n            <Button iconRight onPress={this.reScan} full><Text uppercase={false}>Thử quét lại</Text><Icon type=\"SimpleLineIcons\" name=\"frame\" /></Button> :\n            <Button iconRight onPress={this.closeScreen} full danger><Text uppercase={false}>Đóng</Text><Icon type=\"SimpleLineIcons\" name=\"close\" /></Button>\n            }\n        </Container>\n\n    }\n}\n\nexport default ScanQR;\n\nconst opacity = 'rgba(0, 0, 0, .8)';\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        flexDirection: 'column'\n    },\n    layerTop: {\n        flex: 1,\n        backgroundColor: opacity\n    },\n    layerCenter: {\n        flex: 3,\n        flexDirection: 'row'\n    },\n    layerLeft: {\n        flex: 1,\n        backgroundColor: opacity\n    },\n    focused: {\n        flex: 10\n    },\n    layerRight: {\n        flex: 1,\n        backgroundColor: opacity\n    },\n    layerBottom: {\n        flex: 2,\n        backgroundColor: opacity\n    },\n});"],"mappings":"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"},"metadata":{},"sourceType":"script"}