{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require(\"@babel/runtime/regenerator\"));var _extends2=_interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));var _defineProperty2=_interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));var _expoModulesCore=require(\"expo-modules-core\");var _uuid=require(\"uuid\");var _ImagePicker=require(\"./ImagePicker.types\");var _MediaTypeInput;var MediaTypeInput=(_MediaTypeInput={},(0,_defineProperty2.default)(_MediaTypeInput,_ImagePicker.MediaTypeOptions.All,'video/mp4,video/quicktime,video/x-m4v,video/*,image/*'),(0,_defineProperty2.default)(_MediaTypeInput,_ImagePicker.MediaTypeOptions.Images,'image/*'),(0,_defineProperty2.default)(_MediaTypeInput,_ImagePicker.MediaTypeOptions.Videos,'video/mp4,video/quicktime,video/x-m4v,video/*'),_MediaTypeInput);var _default={get name(){return'ExponentImagePicker';},launchImageLibraryAsync:function launchImageLibraryAsync(_ref){return function _callee(){var _ref$mediaTypes,mediaTypes,_ref$allowsMultipleSe,allowsMultipleSelection,_ref$base,base64;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref$mediaTypes=_ref.mediaTypes,mediaTypes=_ref$mediaTypes===void 0?_ImagePicker.MediaTypeOptions.Images:_ref$mediaTypes,_ref$allowsMultipleSe=_ref.allowsMultipleSelection,allowsMultipleSelection=_ref$allowsMultipleSe===void 0?false:_ref$allowsMultipleSe,_ref$base=_ref.base64,base64=_ref$base===void 0?false:_ref$base;if(_expoModulesCore.Platform.isDOMAvailable){_context.next=3;break;}return _context.abrupt(\"return\",{cancelled:true});case 3:_context.next=5;return _regenerator.default.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection,base64:base64}));case 5:return _context.abrupt(\"return\",_context.sent);case 6:case\"end\":return _context.stop();}}},null,null,null,Promise);}();},launchCameraAsync:function launchCameraAsync(_ref2){return function _callee2(){var _ref2$mediaTypes,mediaTypes,_ref2$allowsMultipleS,allowsMultipleSelection,_ref2$base,base64;return _regenerator.default.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref2$mediaTypes=_ref2.mediaTypes,mediaTypes=_ref2$mediaTypes===void 0?_ImagePicker.MediaTypeOptions.Images:_ref2$mediaTypes,_ref2$allowsMultipleS=_ref2.allowsMultipleSelection,allowsMultipleSelection=_ref2$allowsMultipleS===void 0?false:_ref2$allowsMultipleS,_ref2$base=_ref2.base64,base64=_ref2$base===void 0?false:_ref2$base;if(_expoModulesCore.Platform.isDOMAvailable){_context2.next=3;break;}return _context2.abrupt(\"return\",{cancelled:true});case 3:_context2.next=5;return _regenerator.default.awrap(openFileBrowserAsync({mediaTypes:mediaTypes,allowsMultipleSelection:allowsMultipleSelection,capture:true,base64:base64}));case 5:return _context2.abrupt(\"return\",_context2.sent);case 6:case\"end\":return _context2.stop();}}},null,null,null,Promise);}();},getCameraPermissionsAsync:function getCameraPermissionsAsync(){return function _callee3(){return _regenerator.default.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);}();},requestCameraPermissionsAsync:function requestCameraPermissionsAsync(){return function _callee4(){return _regenerator.default.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);}();},getMediaLibraryPermissionsAsync:function getMediaLibraryPermissionsAsync(_writeOnly){return function _callee5(){return _regenerator.default.async(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);}();},requestMediaLibraryPermissionsAsync:function requestMediaLibraryPermissionsAsync(_writeOnly){return function _callee6(){return _regenerator.default.async(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",permissionGrantedResponse());case 1:case\"end\":return _context6.stop();}}},null,null,null,Promise);}();}};exports.default=_default;function permissionGrantedResponse(){return{status:_expoModulesCore.PermissionStatus.GRANTED,expires:'never',granted:true,canAskAgain:true};}function openFileBrowserAsync(_ref3){var mediaTypes=_ref3.mediaTypes,_ref3$capture=_ref3.capture,capture=_ref3$capture===void 0?false:_ref3$capture,_ref3$allowsMultipleS=_ref3.allowsMultipleSelection,allowsMultipleSelection=_ref3$allowsMultipleS===void 0?false:_ref3$allowsMultipleS,base64=_ref3.base64;var mediaTypeFormat=MediaTypeInput[mediaTypes];var input=document.createElement('input');input.style.display='none';input.setAttribute('type','file');input.setAttribute('accept',mediaTypeFormat);input.setAttribute('id',(0,_uuid.v4)());if(allowsMultipleSelection){input.setAttribute('multiple','multiple');}if(capture){input.setAttribute('capture','camera');}document.body.appendChild(input);return new Promise(function(resolve,reject){input.addEventListener('change',function _callee7(){var img,imgs;return _regenerator.default.async(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(!input.files){_context7.next=12;break;}if(allowsMultipleSelection){_context7.next=8;break;}_context7.next=4;return _regenerator.default.awrap(readFile(input.files[0],{base64:base64}));case 4:img=_context7.sent;resolve((0,_extends2.default)({},img));_context7.next=12;break;case 8:_context7.next=10;return _regenerator.default.awrap(Promise.all(Array.from(input.files).map(function(file){return readFile(file,{base64:base64});})));case 10:imgs=_context7.sent;resolve({cancelled:false,selected:imgs});case 12:document.body.removeChild(input);case 13:case\"end\":return _context7.stop();}}},null,null,null,Promise);});var event=new MouseEvent('click');input.dispatchEvent(event);});}function readFile(targetFile,options){return new Promise(function(resolve,reject){var reader=new FileReader();reader.onerror=function(){reject(new Error(\"Failed to read the selected media because the operation failed.\"));};reader.onload=function(_ref4){var target=_ref4.target;var uri=target.result;var returnRaw=function returnRaw(){return resolve({uri:uri,width:0,height:0,cancelled:false});};if(typeof uri==='string'){var image=new Image();image.src=uri;image.onload=function(){var _image$naturalWidth,_image$naturalHeight;return resolve((0,_extends2.default)({uri:uri,width:(_image$naturalWidth=image.naturalWidth)!=null?_image$naturalWidth:image.width,height:(_image$naturalHeight=image.naturalHeight)!=null?_image$naturalHeight:image.height,cancelled:false},options.base64&&{base64:uri.substr(uri.indexOf(',')+1)}));};image.onerror=function(){return returnRaw();};}else{returnRaw();}};reader.readAsDataURL(targetFile);});}","map":{"version":3,"sources":["../src/ExponentImagePicker.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { PermissionResponse, PermissionStatus, Platform } from 'expo-modules-core';\nimport { v4 } from 'uuid';\n\nimport {\n  ExpandImagePickerResult,\n  ImageInfo,\n  ImagePickerMultipleResult,\n  ImagePickerResult,\n  MediaTypeOptions,\n  OpenFileBrowserOptions,\n} from './ImagePicker.types';\n\nconst MediaTypeInput = {\n  [MediaTypeOptions.All]: 'video/mp4,video/quicktime,video/x-m4v,video/*,image/*',\n  [MediaTypeOptions.Images]: 'image/*',\n  [MediaTypeOptions.Videos]: 'video/mp4,video/quicktime,video/x-m4v,video/*',\n};\n\nexport default {\n  get name(): string {\n    return 'ExponentImagePicker';\n  },\n\n  async launchImageLibraryAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n    base64 = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      base64,\n    });\n  },\n\n  async launchCameraAsync({\n    mediaTypes = MediaTypeOptions.Images,\n    allowsMultipleSelection = false,\n    base64 = false,\n  }): Promise<ImagePickerResult | ImagePickerMultipleResult> {\n    // SSR guard\n    if (!Platform.isDOMAvailable) {\n      return { cancelled: true };\n    }\n    return await openFileBrowserAsync({\n      mediaTypes,\n      allowsMultipleSelection,\n      capture: true,\n      base64,\n    });\n  },\n\n  /*\n   * Delegate to expo-permissions to request camera permissions\n   */\n  async getCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n  async requestCameraPermissionsAsync() {\n    return permissionGrantedResponse();\n  },\n\n  /*\n   * Camera roll permissions don't need to be requested on web, so we always\n   * respond with granted.\n   */\n  async getMediaLibraryPermissionsAsync(_writeOnly: boolean) {\n    return permissionGrantedResponse();\n  },\n  async requestMediaLibraryPermissionsAsync(_writeOnly: boolean): Promise<PermissionResponse> {\n    return permissionGrantedResponse();\n  },\n};\n\nfunction permissionGrantedResponse(): PermissionResponse {\n  return {\n    status: PermissionStatus.GRANTED,\n    expires: 'never',\n    granted: true,\n    canAskAgain: true,\n  };\n}\n\nfunction openFileBrowserAsync<T extends OpenFileBrowserOptions>({\n  mediaTypes,\n  capture = false,\n  allowsMultipleSelection = false,\n  base64,\n}: T): Promise<ExpandImagePickerResult<T>> {\n  const mediaTypeFormat = MediaTypeInput[mediaTypes];\n\n  const input = document.createElement('input');\n  input.style.display = 'none';\n  input.setAttribute('type', 'file');\n  input.setAttribute('accept', mediaTypeFormat);\n  input.setAttribute('id', v4());\n  if (allowsMultipleSelection) {\n    input.setAttribute('multiple', 'multiple');\n  }\n  if (capture) {\n    input.setAttribute('capture', 'camera');\n  }\n  document.body.appendChild(input);\n\n  return new Promise((resolve, reject) => {\n    input.addEventListener('change', async () => {\n      if (input.files) {\n        if (!allowsMultipleSelection) {\n          const img: ImageInfo = await readFile(input.files[0], { base64 });\n          resolve({\n            ...img,\n          } as ExpandImagePickerResult<T>);\n        } else {\n          const imgs: ImageInfo[] = await Promise.all(\n            Array.from(input.files).map((file) => readFile(file, { base64 }))\n          );\n          resolve({\n            cancelled: false,\n            selected: imgs,\n          } as ExpandImagePickerResult<T>);\n        }\n      }\n      document.body.removeChild(input);\n    });\n\n    const event = new MouseEvent('click');\n    input.dispatchEvent(event);\n  });\n}\n\nfunction readFile(targetFile: Blob, options: { base64: boolean }): Promise<ImageInfo> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = () => {\n      reject(new Error(`Failed to read the selected media because the operation failed.`));\n    };\n    reader.onload = ({ target }) => {\n      const uri = (target as any).result;\n      const returnRaw = () =>\n        resolve({\n          uri,\n          width: 0,\n          height: 0,\n          cancelled: false,\n        });\n\n      if (typeof uri === 'string') {\n        const image = new Image();\n        image.src = uri;\n        image.onload = () =>\n          resolve({\n            uri,\n            width: image.naturalWidth ?? image.width,\n            height: image.naturalHeight ?? image.height,\n            cancelled: false,\n            // The blob's result cannot be directly decoded as Base64 without\n            // first removing the Data-URL declaration preceding the\n            // Base64-encoded data. To retrieve only the Base64 encoded string,\n            // first remove data:*/*;base64, from the result.\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL\n            ...(options.base64 && { base64: uri.substr(uri.indexOf(',') + 1) }),\n          });\n        image.onerror = () => returnRaw();\n      } else {\n        returnRaw();\n      }\n    };\n\n    reader.readAsDataURL(targetFile);\n  });\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}