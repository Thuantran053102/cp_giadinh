{"ast":null,"code":"Object.defineProperty(exports,\"__esModule\",{value:true});exports.coalesceCanAskAgain=coalesceCanAskAgain;exports.coalesceExpirations=coalesceExpirations;exports.coalesceGranted=coalesceGranted;exports.coalesceStatuses=coalesceStatuses;var _Permissions=require(\"./Permissions.types\");function coalesceStatuses(permissions){var statuses=Object.keys(permissions).map(function(type){return permissions[type].status;});statuses.sort(function(status1,status2){return _getStatusWeight(status1)-_getStatusWeight(status2);});return statuses[statuses.length-1];}function _getStatusWeight(status){switch(status){case _Permissions.PermissionStatus.GRANTED:return 0;case _Permissions.PermissionStatus.DENIED:return 1;case _Permissions.PermissionStatus.UNDETERMINED:return 2;default:return 100;}}function coalesceExpirations(permissions){var maxExpiration=9007199254740991;var expirations=Object.keys(permissions).map(function(type){return permissions[type].expires;});expirations.sort(function(e1,e2){return(e1==null||e1==='never'?maxExpiration:e1)-(e2==null||e2==='never'?maxExpiration:e2);});return expirations[0];}function coalesceCanAskAgain(permissions){return Object.keys(permissions).reduce(function(canAskAgain,type){return canAskAgain&&permissions[type].canAskAgain;},true);}function coalesceGranted(permissions){return Object.keys(permissions).reduce(function(granted,type){return granted&&permissions[type].granted;},true);}","map":{"version":3,"sources":["../src/CoalescedPermissions.ts"],"names":[],"mappings":"2OAAA,gDAEM,QAAU,iBAAV,CAA2B,WAA3B,CAAqD,CACzD,GAAM,SAAQ,CAAG,MAAM,CAAC,IAAP,CAAY,WAAZ,EAAyB,GAAzB,CAA6B,SAAC,IAAD,QAAU,YAAW,CAAC,IAAD,CAAX,CAAkB,MAA5B,EAA7B,CAAjB,CACA,QAAQ,CAAC,IAAT,CAAc,SAAC,OAAD,CAAU,OAAV,QAAsB,iBAAgB,CAAC,OAAD,CAAhB,CAA4B,gBAAgB,CAAC,OAAD,CAAlE,EAAd,EAEA,MAAO,SAAQ,CAAC,QAAQ,CAAC,MAAT,CAAkB,CAAnB,CAAf,CACD,CAED,QAAS,iBAAT,CAA0B,MAA1B,CAAkD,CAIhD,OAAQ,MAAR,EACE,IAAK,8BAAA,CAAiB,OAAtB,CACE,MAAO,EAAP,CACF,IAAK,8BAAA,CAAiB,MAAtB,CACE,MAAO,EAAP,CACF,IAAK,8BAAA,CAAiB,YAAtB,CACE,MAAO,EAAP,CACF,QACE,MAAO,IAAP,CARJ,CAUD,CAEK,QAAU,oBAAV,CAA8B,WAA9B,CAAwD,CAC5D,GAAM,cAAa,CAAG,gBAAtB,CACA,GAAM,YAAW,CAAG,MAAM,CAAC,IAAP,CAAY,WAAZ,EAAyB,GAAzB,CAA6B,SAAC,IAAD,QAAU,YAAW,CAAC,IAAD,CAAX,CAAkB,OAA5B,EAA7B,CAApB,CACA,WAAW,CAAC,IAAZ,CACE,SAAC,EAAD,CAAK,EAAL,QACE,CAAC,EAAE,EAAI,IAAN,EAAc,EAAE,GAAK,OAArB,CAA+B,aAA/B,CAA+C,EAAhD,GACC,EAAE,EAAI,IAAN,EAAc,EAAE,GAAK,OAArB,CAA+B,aAA/B,CAA+C,EADhD,CADF,EADF,EAMA,MAAO,YAAW,CAAC,CAAD,CAAlB,CACD,CAEK,QAAU,oBAAV,CAA8B,WAA9B,CAAwD,CAC5D,MAAO,OAAM,CAAC,IAAP,CAAY,WAAZ,EAAyB,MAAzB,CACL,SAAC,WAAD,CAAc,IAAd,QAAuB,YAAW,EAAI,WAAW,CAAC,IAAD,CAAX,CAAkB,WAAxD,EADK,CAEL,IAFK,CAAP,CAID,CAEK,QAAU,gBAAV,CAA0B,WAA1B,CAAoD,CACxD,MAAO,OAAM,CAAC,IAAP,CAAY,WAAZ,EAAyB,MAAzB,CACL,SAAC,OAAD,CAAU,IAAV,QAAmB,QAAO,EAAI,WAAW,CAAC,IAAD,CAAX,CAAkB,OAAhD,EADK,CAEL,IAFK,CAAP,CAID","sourcesContent":["import { PermissionExpiration, PermissionMap, PermissionStatus } from './Permissions.types';\n\nexport function coalesceStatuses(permissions: PermissionMap): PermissionStatus {\n  const statuses = Object.keys(permissions).map((type) => permissions[type].status);\n  statuses.sort((status1, status2) => _getStatusWeight(status1) - _getStatusWeight(status2));\n  // We choose the \"heaviest\" status with the most implications\n  return statuses[statuses.length - 1];\n}\n\nfunction _getStatusWeight(status: PermissionStatus): number {\n  // In terms of weight, we treat UNDETERMINED > DENIED > GRANTED since UNDETERMINED requires the\n  // most amount of further handling (prompting for permission and then checking that permission)\n  // and GRANTED requires the least\n  switch (status) {\n    case PermissionStatus.GRANTED:\n      return 0;\n    case PermissionStatus.DENIED:\n      return 1;\n    case PermissionStatus.UNDETERMINED:\n      return 2;\n    default:\n      return 100;\n  }\n}\n\nexport function coalesceExpirations(permissions: PermissionMap): PermissionExpiration {\n  const maxExpiration = 9007199254740991; // Number.MAX_SAFE_INTEGER\n  const expirations = Object.keys(permissions).map((type) => permissions[type].expires);\n  expirations.sort(\n    (e1, e2) =>\n      (e1 == null || e1 === 'never' ? maxExpiration : e1) -\n      (e2 == null || e2 === 'never' ? maxExpiration : e2)\n  );\n  // We choose the earliest expiration\n  return expirations[0];\n}\n\nexport function coalesceCanAskAgain(permissions: PermissionMap): boolean {\n  return Object.keys(permissions).reduce<boolean>(\n    (canAskAgain, type) => canAskAgain && permissions[type].canAskAgain,\n    true\n  );\n}\n\nexport function coalesceGranted(permissions: PermissionMap): boolean {\n  return Object.keys(permissions).reduce<boolean>(\n    (granted, type) => granted && permissions[type].granted,\n    true\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}